<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itec.mapper.ContractMapper">
  <resultMap id="ContractResultMap" type="com.itec.pojo.Contract">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 13 14:58:51 HKT 2024.
    -->
    <id column="CONTR_NO" jdbcType="VARCHAR" property="contrNo" />
    <result column="CONTR_CUST_ID" jdbcType="BIGINT" property="contrCustId" />
    <result column="CONTR_ENGINEER_NM" jdbcType="VARCHAR" property="contrEngineerNm" />
    <result column="CONTR_PROJECT_NM" jdbcType="VARCHAR" property="contrProjectNm" />
    <result column="QUOT_DELFLG" jdbcType="VARCHAR" property="quotDelflg" />
    <result column="CONTR_DELFLG" jdbcType="CHAR" property="contrDelflg" />
    <result column="CONTR_STARTDT" jdbcType="TIMESTAMP" property="contrStartdt" />
    <result column="CONTR_ENDDT" jdbcType="TIMESTAMP" property="contrEnddt" />
    <result column="CONTR_STATUS" jdbcType="VARCHAR" property="contrStatus" />
    <result column="CONTR_RMK" jdbcType="VARCHAR" property="contrRmk" />
    <result column="CONTR_PRICE_PER" jdbcType="INTEGER" property="contrPricePer" />
    <result column="PURCHASE_PRICE" jdbcType="INTEGER" property="purchasePrice" />
    <result column="EXCESS_UNITPRICE" jdbcType="INTEGER" property="excessUnitprice" />
    <result column="DEDU_UNITPRICE" jdbcType="INTEGER" property="deduUnitprice" />
    <result column="SETTLEMENT_UNIT" jdbcType="VARCHAR" property="settlementUnit" />
    <result column="CONTR_UPPER_LIMIT" jdbcType="VARCHAR" property="contrUpperLimit" />
    <result column="CONTR_LOWER_LIMIT" jdbcType="VARCHAR" property="contrLowerLimit" />
    <result column="CONTR_AMOUNT_SUBTOTAL" jdbcType="INTEGER" property="contrAmountSubtotal" />
    <result column="CONSUMPTION_TAX" jdbcType="INTEGER" property="consumptionTax" />
    <result column="TOTAL_AMOUNT" jdbcType="INTEGER" property="totalAmount" />
    <result column="CONTR_CRD_USR" jdbcType="VARCHAR" property="contrCrdUsr" />
    <result column="CONTR_CRD_DT" jdbcType="TIMESTAMP" property="contrCrdDt" />
    <result column="CONTR_UPD_USR" jdbcType="VARCHAR" property="contrUpdUsr" />
    <result column="CONTR_UPD_DT" jdbcType="TIMESTAMP" property="contrUpdDt" />
  </resultMap>
  <resultMap id="OperateResultMap" type="com.itec.pojo.Operate">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 13 14:58:51 HKT 2024.
    -->
    <id column="OPER_ID" jdbcType="BIGINT" property="operId" />
    <id column="OPER_NO" jdbcType="VARCHAR" property="operNo" />
    <result column="OPER_ENGINEER_NM" jdbcType="VARCHAR" property="operEngineerNm" />
    <result column="OPER_PROJECT_NM" jdbcType="VARCHAR" property="operProjectNm" />
    <result column="OPER_PRICE_PER" jdbcType="INTEGER" property="operPricePer" />
    <result column="OPER_PURCHASE_PRICE" jdbcType="INTEGER" property="operPurchasePrice" />
    <result column="OPER_STARTDT" jdbcType="TIMESTAMP" property="operStartdt" />
    <result column="OPER_ENDDT" jdbcType="TIMESTAMP" property="operEnddt" />
    <result column="OPER_STATUS" jdbcType="VARCHAR" property="operStatus" />
    <result column="OPER_EXCESS_UNITPRICE" jdbcType="INTEGER" property="operExcessUnitprice" />
    <result column="OPER_DEDUCTION_UNITPRICE" jdbcType="INTEGER" property="operDeductionUnitprice" />
    <result column="OPER_SETTLEMENT_UNIT" jdbcType="VARCHAR" property="operSettlementUnit" />
    <result column="OPER_UPPER_LIMIT" jdbcType="VARCHAR" property="operUpperLimit" />
    <result column="OPER_LOWER_LIMIT" jdbcType="VARCHAR" property="operLowerLimit" />
    <result column="OPER_RMK" jdbcType="VARCHAR" property="operRmk" />
    <result column="OPER_CRD_USR" jdbcType="VARCHAR" property="operCrdUsr" />
    <result column="OPER_CRD_DT" jdbcType="TIMESTAMP" property="operCrdDt" />
    <result column="OPER_UPD_USR" jdbcType="VARCHAR" property="operUpdUsr" />
    <result column="OPER_UPD_DT" jdbcType="TIMESTAMP" property="operUpdDt" />
  </resultMap>
  
  <resultMap id="ContrOperResultMap" type="com.itec.pojo.ContrOperRequest">
        <association property="contract" resultMap="ContractResultMap"/>
        <collection property="operates" ofType="com.itec.pojo.Operate" resultMap="OperateResultMap"/>
    </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 13 14:58:51 HKT 2024.
    -->
    CONTR_NO, CONTR_CUST_ID, CONTR_ENGINEER_NM, CONTR_PROJECT_NM, QUOT_DELFLG, CONTR_DELFLG, 
    CONTR_STARTDT, CONTR_ENDDT, CONTR_STATUS, CONTR_RMK, CONTR_PRICE_PER, PURCHASE_PRICE, 
    EXCESS_UNITPRICE, DEDU_UNITPRICE, SETTLEMENT_UNIT, CONTR_UPPER_LIMIT, CONTR_LOWER_LIMIT, 
    CONTR_AMOUNT_SUBTOTAL, CONSUMPTION_TAX, TOTAL_AMOUNT, CONTR_CRD_USR, CONTR_CRD_DT, 
    CONTR_UPD_USR, CONTR_UPD_DT
  </sql>
  
   <!-- 概览查询 小于号转写为&lt;-->
<select id="selectContrGeneral" resultType="com.itec.pojo.Contract">
    SELECT 
        m.CONTR_NO,
        c.CUST_NM, 
        m.CONTR_PROJECT_NM, 
        m.CONTR_STATUS, 
        m.CONTR_STARTDT, 
        m.CONTR_RMK, 
        m.CONTR_CRD_USR
    FROM 
        cust_tbl c 
    JOIN 
        CONTRACT_TBL m ON c.CUST_ID = m.CONTR_CUST_ID
    <where>
        <if test="contractQuaryCondition.quotDelflg != null and contractQuaryCondition.quotDelflg !=''">
            AND m.QUOT_DELFLG = #{contractQuaryCondition.quotDelflg,jdbcType=VARCHAR}
        </if>
        <if test="contractQuaryCondition.custNm != null and contractQuaryCondition.custNm !=''">
            AND c.CUST_NM LIKE CONCAT('%', #{contractQuaryCondition.custNm}, '%')
        </if>
        <if test="contractQuaryCondition.contrEngineerNm != null and contractQuaryCondition.contrEngineerNm !=''">
            AND m.CONTR_ENGINEER_NM LIKE CONCAT('%', #{contractQuaryCondition.contrEngineerNm}, '%')
        </if>
        <if test="contractQuaryCondition.contrProjectNm != null and contractQuaryCondition.contrProjectNm !=''">
            AND m.CONTR_PROJECT_NM LIKE CONCAT('%', #{contractQuaryCondition.contrProjectNm}, '%')
        </if>
        <if test="contractQuaryCondition.contrStatus != null and contractQuaryCondition.contrStatus !=''">
            AND m.CONTR_STATUS = #{contractQuaryCondition.contrStatus,jdbcType=VARCHAR}
        </if>
       <if test="contractQuaryCondition.contrStartdt != null and contractQuaryCondition.contrStartdt !=''">
            AND m.CONTR_STARTDT >= #{contractQuaryCondition.contrStartdt,jdbcType=TIMESTAMP}
        </if>
        <if test="contractQuaryCondition.contrEnddt != null and contractQuaryCondition.contrEnddt !=''">
            AND m.CONTR_ENDDT &lt;= #{contractQuaryCondition.contrEnddt,jdbcType=TIMESTAMP}
        </if>
        
    </where>
    AND m.CONTR_DELFLG = 0
    ORDER BY 
        m.CONTR_STARTDT ASC 
    LIMIT 
        #{startIndex}, #{limit} 
</select>

<!-- 概览查询条数 -->
<select id="selectContrGeneralNum" resultType="int">
    SELECT 
        COUNT(*) 
    FROM 
        cust_tbl c 
    JOIN 
        CONTRACT_TBL m ON c.CUST_ID = m.CONTR_CUST_ID
    <where>
        <if test="contractQuaryCondition.quotDelflg != null">
            AND m.QUOT_DELFLG = #{contractQuaryCondition.quotDelflg,jdbcType=VARCHAR}
        </if>
        <if test="contractQuaryCondition.custNm != null">
            AND c.CUST_NM LIKE CONCAT('%', #{contractQuaryCondition.custNm}, '%')
        </if>
        <if test="contractQuaryCondition.contrEngineerNm != null">
            AND m.CONTR_ENGINEER_NM LIKE CONCAT('%', #{contractQuaryCondition.contrEngineerNm}, '%')
        </if>
        <if test="contractQuaryCondition.contrProjectNm != null">
            AND m.CONTR_PROJECT_NM LIKE CONCAT('%', #{contractQuaryCondition.contrProjectNm}, '%')
        </if>
        <if test="contractQuaryCondition.contrStatus != null">
            AND m.CONTR_STATUS = #{contractQuaryCondition.contrStatus,jdbcType=VARCHAR}
        </if>
        <if test="contractQuaryCondition.contrStartdt != null">
            AND m.CONTR_STARTDT >= #{contractQuaryCondition.contrStartdt,jdbcType=TIMESTAMP}
        </if>
        <if test="contractQuaryCondition.contrEnddt != null">
            AND m.CONTR_ENDDT &lt;= #{contractQuaryCondition.contrEnddt,jdbcType=TIMESTAMP}
        </if>
        AND m.CONTR_DELFLG = 0
    </where>
</select>

<!-- ID查询contr -->
<select id="selectContrById" resultMap="ContractResultMap">
    select 
        *
    from 
        CONTRACT_TBL
    where 
        CONTR_NO = #{contrNo,jdbcType=VARCHAR} 
        and CONTR_DELFLG = 0
</select>

<!-- ID查询contr及oper -->
<select id="selectContrOperById" resultMap="ContrOperResultMap">
    select 
        *
    from  
        M_OPERATE_TBL o 
    JOIN 
        CONTRACT_TBL m ON o.OPER_NO = m.CONTR_NO
    where 
        m.CONTR_NO = #{contrNo,jdbcType=VARCHAR} 
        and m.CONTR_DELFLG = 0
</select>

<!-- 逻辑删除 -->
<delete id="deleteContrById" parameterType="java.lang.String">
    update 
        CONTRACT_TBL 
    set 
        CONTR_DELFLG = 1
    where 
        CONTR_NO = #{contrNo,jdbcType=VARCHAR}
</delete>
 
 <!--单独新增-->
  <insert id="insertContr" parameterType="com.itec.pojo.Contract">
    insert into CONTRACT_TBL
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="contrNo != null">
        CONTR_NO,
      </if>
      <if test="contrCustId != null">
        CONTR_CUST_ID,
      </if>
      <if test="contrEngineerNm != null">
        CONTR_ENGINEER_NM,
      </if>
      <if test="contrProjectNm != null">
        CONTR_PROJECT_NM,
      </if>
      <if test="quotDelflg != null">
        QUOT_DELFLG,
      </if>
      <if test="contrDelflg != null">
        CONTR_DELFLG,
      </if>
      <if test="contrStartdt != null">
        CONTR_STARTDT,
      </if>
      <if test="contrEnddt != null">
        CONTR_ENDDT,
      </if>
      <if test="contrStatus != null">
        CONTR_STATUS,
      </if>
      <if test="contrRmk != null">
        CONTR_RMK,
      </if>
      <if test="contrPricePer != null">
        CONTR_PRICE_PER,
      </if>
      <if test="purchasePrice != null">
        PURCHASE_PRICE,
      </if>
      <if test="excessUnitprice != null">
        EXCESS_UNITPRICE,
      </if>
      <if test="deduUnitprice != null">
        DEDU_UNITPRICE,
      </if>
      <if test="settlementUnit != null">
        SETTLEMENT_UNIT,
      </if>
      <if test="contrUpperLimit != null">
        CONTR_UPPER_LIMIT,
      </if>
      <if test="contrLowerLimit != null">
        CONTR_LOWER_LIMIT,
      </if>
      <if test="contrAmountSubtotal != null">
        CONTR_AMOUNT_SUBTOTAL,
      </if>
      <if test="consumptionTax != null">
        CONSUMPTION_TAX,
      </if>
      <if test="totalAmount != null">
        TOTAL_AMOUNT,
      </if>
      <if test="contrCrdUsr != null">
        CONTR_CRD_USR,
      </if>
      <if test="contrCrdDt != null">
        CONTR_CRD_DT,
      </if>
      <if test="contrUpdUsr != null">
        CONTR_UPD_USR,
      </if>
      <if test="contrUpdDt != null">
        CONTR_UPD_DT,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="contrNo != null">
        #{contrNo,jdbcType=VARCHAR},
      </if>
      <if test="contrCustId != null">
        #{contrCustId,jdbcType=BIGINT},
      </if>
      <if test="contrEngineerNm != null">
        #{contrEngineerNm,jdbcType=VARCHAR},
      </if>
      <if test="contrProjectNm != null">
        #{contrProjectNm,jdbcType=VARCHAR},
      </if>
      <if test="quotDelflg != null">
        #{quotDelflg,jdbcType=VARCHAR},
      </if>
      <if test="contrDelflg != null">
        #{contrDelflg,jdbcType=CHAR},
      </if>
      <if test="contrStartdt != null">
        #{contrStartdt,jdbcType=TIMESTAMP},
      </if>
      <if test="contrEnddt != null">
        #{contrEnddt,jdbcType=TIMESTAMP},
      </if>
      <if test="contrStatus != null">
        #{contrStatus,jdbcType=VARCHAR},
      </if>
      <if test="contrRmk != null">
        #{contrRmk,jdbcType=VARCHAR},
      </if>
      <if test="contrPricePer != null">
        #{contrPricePer,jdbcType=INTEGER},
      </if>
      <if test="purchasePrice != null">
        #{purchasePrice,jdbcType=INTEGER},
      </if>
      <if test="excessUnitprice != null">
        #{excessUnitprice,jdbcType=INTEGER},
      </if>
      <if test="deduUnitprice != null">
        #{deduUnitprice,jdbcType=INTEGER},
      </if>
      <if test="settlementUnit != null">
        #{settlementUnit,jdbcType=VARCHAR},
      </if>
      <if test="contrUpperLimit != null">
        #{contrUpperLimit,jdbcType=VARCHAR},
      </if>
      <if test="contrLowerLimit != null">
        #{contrLowerLimit,jdbcType=VARCHAR},
      </if>
      <if test="contrAmountSubtotal != null">
        #{contrAmountSubtotal,jdbcType=INTEGER},
      </if>
      <if test="consumptionTax != null">
        #{consumptionTax,jdbcType=INTEGER},
      </if>
      <if test="totalAmount != null">
        #{totalAmount,jdbcType=INTEGER},
      </if>
      <if test="contrCrdUsr != null">
        #{contrCrdUsr,jdbcType=VARCHAR},
      </if>
      <if test="contrCrdDt != null">
        #{contrCrdDt,jdbcType=TIMESTAMP},
      </if>
      <if test="contrUpdUsr != null">
        #{contrUpdUsr,jdbcType=VARCHAR},
      </if>
      <if test="contrUpdDt != null">
        #{contrUpdDt,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
  <!--单独更新-->
  <update id="updateContrById" parameterType="com.itec.pojo.Contract">
    update CONTRACT_TBL
    <set>
      <if test="contrCustId != null">
        CONTR_CUST_ID = #{contrCustId,jdbcType=BIGINT},
      </if>
      <if test="contrEngineerNm != null">
        CONTR_ENGINEER_NM = #{contrEngineerNm,jdbcType=VARCHAR},
      </if>
      <if test="contrProjectNm != null">
        CONTR_PROJECT_NM = #{contrProjectNm,jdbcType=VARCHAR},
      </if>
      <if test="quotDelflg != null">
        QUOT_DELFLG = #{quotDelflg,jdbcType=VARCHAR},
      </if>
      <if test="contrDelflg != null">
        CONTR_DELFLG = #{contrDelflg,jdbcType=CHAR},
      </if>
      <if test="contrStartdt != null">
        CONTR_STARTDT = #{contrStartdt,jdbcType=TIMESTAMP},
      </if>
      <if test="contrEnddt != null">
        CONTR_ENDDT = #{contrEnddt,jdbcType=TIMESTAMP},
      </if>
      <if test="contrStatus != null">
        CONTR_STATUS = #{contrStatus,jdbcType=VARCHAR},
      </if>
      <if test="contrRmk != null">
        CONTR_RMK = #{contrRmk,jdbcType=VARCHAR},
      </if>
      <if test="contrPricePer != null">
        CONTR_PRICE_PER = #{contrPricePer,jdbcType=INTEGER},
      </if>
      <if test="purchasePrice != null">
        PURCHASE_PRICE = #{purchasePrice,jdbcType=INTEGER},
      </if>
      <if test="excessUnitprice != null">
        EXCESS_UNITPRICE = #{excessUnitprice,jdbcType=INTEGER},
      </if>
      <if test="deduUnitprice != null">
        DEDU_UNITPRICE = #{deduUnitprice,jdbcType=INTEGER},
      </if>
      <if test="settlementUnit != null">
        SETTLEMENT_UNIT = #{settlementUnit,jdbcType=VARCHAR},
      </if>
      <if test="contrUpperLimit != null">
        CONTR_UPPER_LIMIT = #{contrUpperLimit,jdbcType=VARCHAR},
      </if>
      <if test="contrLowerLimit != null">
        CONTR_LOWER_LIMIT = #{contrLowerLimit,jdbcType=VARCHAR},
      </if>
      <if test="contrAmountSubtotal != null">
        CONTR_AMOUNT_SUBTOTAL = #{contrAmountSubtotal,jdbcType=INTEGER},
      </if>
      <if test="consumptionTax != null">
        CONSUMPTION_TAX = #{consumptionTax,jdbcType=INTEGER},
      </if>
      <if test="totalAmount != null">
        TOTAL_AMOUNT = #{totalAmount,jdbcType=INTEGER},
      </if>
      <if test="contrCrdUsr != null">
        CONTR_CRD_USR = #{contrCrdUsr,jdbcType=VARCHAR},
      </if>
      <if test="contrCrdDt != null">
        CONTR_CRD_DT = #{contrCrdDt,jdbcType=TIMESTAMP},
      </if>
      <if test="contrUpdUsr != null">
        CONTR_UPD_USR = #{contrUpdUsr,jdbcType=VARCHAR},
      </if>
      <if test="contrUpdDt != null">
        CONTR_UPD_DT = #{contrUpdDt,jdbcType=TIMESTAMP},
      </if>
    </set>
    where CONTR_NO = #{contrNo,jdbcType=VARCHAR}
  </update>
  
</mapper>