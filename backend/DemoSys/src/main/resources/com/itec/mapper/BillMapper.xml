<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itec.mapper.BillMapper">
  <resultMap id="BillResultMap" type="com.itec.pojo.Bill">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jan 03 13:11:56 HKT 2025.
    -->
    <id column="BILL_NO" jdbcType="VARCHAR" property="billNo" />
    <result column="BILL_NM" jdbcType="VARCHAR" property="billNm" />
    <result column="BILL_ENGINEER_NM" jdbcType="VARCHAR" property="billEngineerNm" />
    <result column="BILL_CUST_NM" jdbcType="VARCHAR" property="billCustNm" />
    <result column="BILL_PROJECT_NM" jdbcType="VARCHAR" property="billProjectNm" />
    <result column="BILL_STARTDT" jdbcType="TIMESTAMP" property="billStartdt" />
    <result column="BILL_ENDTDT" jdbcType="TIMESTAMP" property="billEndtdt" />
    <result column="BILL_CONFIRMFLG" jdbcType="CHAR" property="billConfirmflg" />
    <result column="BILL_DELFLG" jdbcType="CHAR" property="billDelflg" />
    <result column="BILL_CLS" jdbcType="VARCHAR" property="billCls" />
    <result column="BILL_STATUS" jdbcType="VARCHAR" property="billStatus" />
    <result column="BILL_PAYMENT_TERM" jdbcType="TIMESTAMP" property="billPaymentTerm" />
    <result column="BILL_CHARGED_AMOUNT" jdbcType="INTEGER" property="billChargedAmount" />
    <result column="BILL_TAX_RATE" jdbcType="VARCHAR" property="billTaxRate" />
    <result column="BILL_AMOUNT_SUBTOTAL" jdbcType="INTEGER" property="billAmountSubtotal" />
    <result column="BILL_CONSUMPTION_TAX" jdbcType="INTEGER" property="billConsumptionTax" />
    <result column="BILL_TOTAL_AMOUNT" jdbcType="INTEGER" property="billTotalAmount" />
    <result column="BILL_RMK" jdbcType="VARCHAR" property="billRmk" />
    <result column="BILL_CRD_USR" jdbcType="VARCHAR" property="billCrdUsr" />
    <result column="BILL_CRD_DT" jdbcType="TIMESTAMP" property="billCrdDt" />
    <result column="BILL_UPD_USR" jdbcType="VARCHAR" property="billUpdUsr" />
    <result column="BILL_UPD_DT" jdbcType="TIMESTAMP" property="billUpdDt" />
  </resultMap>
  
  <resultMap id="BillDetlResultMap" type="com.itec.pojo.BillDetl">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jan 03 13:11:56 HKT 2025.
    -->
    <id column="BILLDETL_ID" jdbcType="BIGINT" property="billdetlId" />
    <id column="BILLDETL_NO" jdbcType="VARCHAR" property="billdetlNo" />
    <result column="BILLDETL_ENGINEER_NM" jdbcType="VARCHAR" property="billdetlEngineerNm" />
    <result column="BILLDETL_PRICE_PER" jdbcType="INTEGER" property="billdetlPricePer" />
    <result column="BILLDETL_AMOUNT" jdbcType="INTEGER" property="billdetlAmount" />
    <result column="BILLDETL_DEDU_TIME" jdbcType="INTEGER" property="billdetlDeduTime" />
    <result column="BILLDETL_EXCESS_TIME" jdbcType="INTEGER" property="billdetlExcessTime" />
    <result column="BILLDETL_DEDU_UNITPRICE" jdbcType="INTEGER" property="billdetlDeduUnitprice" />
    <result column="BILLDETL_EXCESS_UNITPRICE" jdbcType="INTEGER" property="billdetlExcessUnitprice" />
    <result column="BILLDETL_PRETAXAMO" jdbcType="INTEGER" property="billdetlPretaxamo" />
    <result column="BILLDETL_TRANS_EXPENSES" jdbcType="INTEGER" property="billdetlTransExpenses" />
    <result column="BILLDETL_TOTALAMO" jdbcType="INTEGER" property="billdetlTotalamo" />
    <result column="BILLDETL_RMK" jdbcType="VARCHAR" property="billdetlRmk" />
    <result column="BILLDETL_CRD_USR" jdbcType="VARCHAR" property="billdetlCrdUsr" />
    <result column="BILLDETL_CRD_DT" jdbcType="TIMESTAMP" property="billdetlCrdDt" />
    <result column="BILLDETL_UPD_USR" jdbcType="VARCHAR" property="billdetlUpdUsr" />
    <result column="BILLDETL_UPD_DT" jdbcType="TIMESTAMP" property="billdetlUpdDt" />
  </resultMap>
  
  <resultMap id="BillBillDetlResultMap" type="com.itec.pojo.BillBillDtelRequest">
        <association property="bill" resultMap="BillResultMap"/>
        <collection property="billDetls" ofType="com.itec.pojo.BillDetl" resultMap="BillDetlResultMap"/>
    </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jan 03 13:11:56 HKT 2025.
    -->
    BILL_NO, BILL_NM, BILL_ENGINEER_NM, BILL_CUST_NM, BILL_PROJECT_NM, BILL_STARTDT, 
    BILL_ENDTDT, BILL_CONFIRMFLG, BILL_DELFLG, BILL_CLS, BILL_STATUS, BILL_PAYMENT_TERM, 
    BILL_CHARGED_AMOUNT, BILL_TAX_RATE, BILL_AMOUNT_SUBTOTAL, BILL_CONSUMPTION_TAX, BILL_TOTAL_AMOUNT, 
    BILL_RMK, BILL_CRD_USR, BILL_CRD_DT, BILL_UPD_USR, BILL_UPD_DT
  </sql>
   <!-- 概览查询 小于号转写为&lt;-->
<select id="selectBillGeneral" resultType="com.itec.pojo.Bill">
    SELECT DISTINCT
        b.BILL_NO,
        b.BILL_CUST_NM,
        b.BILL_PROJECT_NM, 
        b.BILL_STATUS, 
        b.BILL_PAYMENT_TERM,
        b.BILL_CHARGED_AMOUNT, 
        b.BILL_CRD_USR,
        b.BILL_STARTDT
    FROM BILL_TBL b
     JOIN 
        BILLDETL_TBL bd ON b.BILL_NO = bd.BILLDETL_NO
    <where>
        <if test="billQuaryCondition.billCls != null and billQuaryCondition.billCls !=''">
            AND b.BILL_CLS = #{billQuaryCondition.billCls}
        </if>
        <if test="billQuaryCondition.billNm != null and billQuaryCondition.billNm !=''">
            AND b.BILL_NM LIKE CONCAT('%', #{billQuaryCondition.billNm}, '%')
        </if>
        <if test="billQuaryCondition.billProjectNm != null and billQuaryCondition.billProjectNm !=''">
            AND b.BILL_PROJECT_NM LIKE CONCAT('%', #{billQuaryCondition.billProjectNm}, '%')
        </if>
        <if test="billQuaryCondition.billdetlEngineerNm != null and billQuaryCondition.billdetlEngineerNm !=''">
            AND bd.BILLDETL_ENGINEER_NM LIKE CONCAT('%', #{billQuaryCondition.billdetlEngineerNm}, '%')
        </if>
        <if test="billQuaryCondition.billStatus != null and billQuaryCondition.billStatus !=''">
            AND b.BILL_STATUS = #{billQuaryCondition.billStatus}
        </if>
       <if test="billQuaryCondition.billStartdt != null">
            AND b.BILL_STARTDT >= #{billQuaryCondition.billStartdt}
        </if>
        <if test="billQuaryCondition.billEndtdt != null">
            AND b.BILL_ENDTDT &lt;= #{billQuaryCondition.billEndtdt}
        </if>
    </where>
    AND b.BILL_DELFLG = 0
    ORDER BY 
        b.BILL_NO ASC 
    LIMIT 
        #{startIndex}, #{limit} 
</select>
  
  <!-- 概览查询条数 -->
<select id="selectBillGeneralNum" resultType="int">
    SELECT
       COUNT(DISTINCT b.BILL_NO) as contractCount
     FROM BILL_TBL b
     JOIN 
        BILLDETL_TBL bd ON b.BILL_NO = bd.BILLDETL_NO
     <where>
        <if test="billQuaryCondition.billCls != null and billQuaryCondition.billCls !=''">
            AND b.BILL_CLS = #{billQuaryCondition.billCls}
        </if>
        <if test="billQuaryCondition.billNm != null and billQuaryCondition.billNm !=''">
            AND b.BILL_NM LIKE CONCAT('%', #{billQuaryCondition.billNm}, '%')
        </if>
        <if test="billQuaryCondition.billProjectNm != null and billQuaryCondition.billProjectNm !=''">
            AND b.BILL_PROJECT_NM LIKE CONCAT('%', #{billQuaryCondition.billProjectNm}, '%')
        </if>
        <if test="billQuaryCondition.billdetlEngineerNm != null and billQuaryCondition.billdetlEngineerNm !=''">
            AND bd.BILLDETL_ENGINEER_NM LIKE CONCAT('%', #{billQuaryCondition.billdetlEngineerNm}, '%')
        </if>
        <if test="billQuaryCondition.billStatus != null and billQuaryCondition.billStatus !=''">
            AND b.BILL_STATUS = #{billQuaryCondition.billStatus}
        </if>
       <if test="billQuaryCondition.billStartdt != null">
            AND b.BILL_STARTDT >= #{billQuaryCondition.billStartdt}
        </if>
        <if test="billQuaryCondition.billEndtdt != null">
            AND b.BILL_ENDTDT &lt;= #{billQuaryCondition.billEndtdt}
        </if>
    </where>
    AND b.BILL_DELFLG = 0
</select>
  
  <!-- ID查询 -->
<select id="selectBillById" resultMap="BillResultMap">
    select 
        *
    from 
        BILL_TBL
    where 
        BILL_NO = #{billNo,jdbcType=VARCHAR} 
        and BILL_DELFLG = 0
</select>

<!-- ID查询总 -->
<select id="selectBillBillDeltById" resultMap="BillBillDetlResultMap">
    select 
        b.*,
        bd.*
    from  
        BILL_TBL b 
    JOIN 
        BILLDETL_TBL bd ON b.BILL_NO = bd.BILLDETL_NO
    where 
         b.BILL_NO = #{billNo,jdbcType=VARCHAR} 
        and b.BILL_DELFLG = 0
</select>

<!-- 逻辑删除 -->
<delete id="deleteBillById" parameterType="java.lang.String">
    update 
        BILL_TBL 
    set 
        BILL_DELFLG = 1
    where 
        BILL_NO = #{billNo,jdbcType=VARCHAR}
</delete>
  
  
   <!--单独新增-->
  <insert id="insertBill" parameterType="com.itec.pojo.Bill">
    insert into BILL_TBL
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="billNo != null">
        BILL_NO,
      </if>
      <if test="billNm != null">
        BILL_NM,
      </if>
      <if test="billEngineerNm != null">
        BILL_ENGINEER_NM,
      </if>
      <if test="billCustNm != null">
        BILL_CUST_NM,
      </if>
      <if test="billProjectNm != null">
        BILL_PROJECT_NM,
      </if>
      <if test="billStartdt != null">
        BILL_STARTDT,
      </if>
      <if test="billEndtdt != null">
        BILL_ENDTDT,
      </if>
      <if test="billConfirmflg != null">
        BILL_CONFIRMFLG,
      </if>
      <if test="billDelflg != null">
        BILL_DELFLG,
      </if>
      <if test="billCls != null">
        BILL_CLS,
      </if>
      <if test="billStatus != null">
        BILL_STATUS,
      </if>
      <if test="billPaymentTerm != null">
        BILL_PAYMENT_TERM,
      </if>
      <if test="billChargedAmount != null">
        BILL_CHARGED_AMOUNT,
      </if>
      <if test="billTaxRate != null">
        BILL_TAX_RATE,
      </if>
      <if test="billAmountSubtotal != null">
        BILL_AMOUNT_SUBTOTAL,
      </if>
      <if test="billConsumptionTax != null">
        BILL_CONSUMPTION_TAX,
      </if>
      <if test="billTotalAmount != null">
        BILL_TOTAL_AMOUNT,
      </if>
      <if test="billRmk != null">
        BILL_RMK,
      </if>
      <if test="billCrdUsr != null">
        BILL_CRD_USR,
      </if>
      <if test="billCrdDt != null">
        BILL_CRD_DT,
      </if>
      <if test="billUpdUsr != null">
        BILL_UPD_USR,
      </if>
      <if test="billUpdDt != null">
        BILL_UPD_DT,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="billNo != null">
        #{billNo,jdbcType=VARCHAR},
      </if>
      <if test="billNm != null">
        #{billNm,jdbcType=VARCHAR},
      </if>
      <if test="billEngineerNm != null">
        #{billEngineerNm,jdbcType=VARCHAR},
      </if>
      <if test="billCustNm != null">
        #{billCustNm,jdbcType=VARCHAR},
      </if>
      <if test="billProjectNm != null">
        #{billProjectNm,jdbcType=VARCHAR},
      </if>
      <if test="billStartdt != null">
        #{billStartdt,jdbcType=TIMESTAMP},
      </if>
      <if test="billEndtdt != null">
        #{billEndtdt,jdbcType=TIMESTAMP},
      </if>
      <if test="billConfirmflg != null">
        #{billConfirmflg,jdbcType=CHAR},
      </if>
      <if test="billDelflg != null">
        #{billDelflg,jdbcType=CHAR},
      </if>
      <if test="billCls != null">
        #{billCls,jdbcType=VARCHAR},
      </if>
      <if test="billStatus != null">
        #{billStatus,jdbcType=VARCHAR},
      </if>
      <if test="billPaymentTerm != null">
        #{billPaymentTerm,jdbcType=TIMESTAMP},
      </if>
      <if test="billChargedAmount != null">
        #{billChargedAmount,jdbcType=INTEGER},
      </if>
      <if test="billTaxRate != null">
        #{billTaxRate,jdbcType=VARCHAR},
      </if>
      <if test="billAmountSubtotal != null">
        #{billAmountSubtotal,jdbcType=INTEGER},
      </if>
      <if test="billConsumptionTax != null">
        #{billConsumptionTax,jdbcType=INTEGER},
      </if>
      <if test="billTotalAmount != null">
        #{billTotalAmount,jdbcType=INTEGER},
      </if>
      <if test="billRmk != null">
        #{billRmk,jdbcType=VARCHAR},
      </if>
      <if test="billCrdUsr != null">
        #{billCrdUsr,jdbcType=VARCHAR},
      </if>
      <if test="billCrdDt != null">
        #{billCrdDt,jdbcType=TIMESTAMP},
      </if>
      <if test="billUpdUsr != null">
        #{billUpdUsr,jdbcType=VARCHAR},
      </if>
      <if test="billUpdDt != null">
        #{billUpdDt,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
   <!--单独更新-->
  <update id="updateBillById" parameterType="com.itec.pojo.Bill">
    update BILL_TBL
    <set>
      <if test="billNm != null">
        BILL_NM = #{billNm,jdbcType=VARCHAR},
      </if>
      <if test="billEngineerNm != null">
        BILL_ENGINEER_NM = #{billEngineerNm,jdbcType=VARCHAR},
      </if>
      <if test="billCustNm != null">
        BILL_CUST_NM = #{billCustNm,jdbcType=VARCHAR},
      </if>
      <if test="billProjectNm != null">
        BILL_PROJECT_NM = #{billProjectNm,jdbcType=VARCHAR},
      </if>
      <if test="billStartdt != null">
        BILL_STARTDT = #{billStartdt,jdbcType=TIMESTAMP},
      </if>
      <if test="billEndtdt != null">
        BILL_ENDTDT = #{billEndtdt,jdbcType=TIMESTAMP},
      </if>
      <if test="billConfirmflg != null">
        BILL_CONFIRMFLG = #{billConfirmflg,jdbcType=CHAR},
      </if>
      <if test="billCls != null">
        BILL_CLS = #{billCls,jdbcType=VARCHAR},
      </if>
      <if test="billStatus != null">
        BILL_STATUS = #{billStatus,jdbcType=VARCHAR},
      </if>
      <if test="billPaymentTerm != null">
        BILL_PAYMENT_TERM = #{billPaymentTerm,jdbcType=TIMESTAMP},
      </if>
      <if test="billChargedAmount != null">
        BILL_CHARGED_AMOUNT = #{billChargedAmount,jdbcType=INTEGER},
      </if>
      <if test="billTaxRate != null">
        BILL_TAX_RATE = #{billTaxRate,jdbcType=VARCHAR},
      </if>
      <if test="billAmountSubtotal != null">
        BILL_AMOUNT_SUBTOTAL = #{billAmountSubtotal,jdbcType=INTEGER},
      </if>
      <if test="billConsumptionTax != null">
        BILL_CONSUMPTION_TAX = #{billConsumptionTax,jdbcType=INTEGER},
      </if>
      <if test="billTotalAmount != null">
        BILL_TOTAL_AMOUNT = #{billTotalAmount,jdbcType=INTEGER},
      </if>
      <if test="billRmk != null">
        BILL_RMK = #{billRmk,jdbcType=VARCHAR},
      </if>
      <if test="billCrdUsr != null">
        BILL_CRD_USR = #{billCrdUsr,jdbcType=VARCHAR},
      </if>
      <if test="billCrdDt != null">
        BILL_CRD_DT = #{billCrdDt,jdbcType=TIMESTAMP},
      </if>
      <if test="billUpdUsr != null">
        BILL_UPD_USR = #{billUpdUsr,jdbcType=VARCHAR},
      </if>
      <if test="billUpdDt != null">
        BILL_UPD_DT = #{billUpdDt,jdbcType=TIMESTAMP},
      </if>
    </set>
    where BILL_NO = #{billNo,jdbcType=VARCHAR} AND BILL_DELFLG =0
  </update>
  
</mapper>